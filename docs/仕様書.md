# アプリケーション仕様書

## プロジェクト名

Emoji Generator (絵文字ジェネレーター)

## 1. ソフトウェア概要

SlackやDiscordなどのカスタム絵文字として利用可能な、テキストベースの絵文字を生成するWebアプリケーション。ユーザーはWebサイト上で任意のテキスト、フォント、色を選択します。入力された設定はバックエンドAPIに送信され、サーバーサイドで画像が生成されます。ユーザーは生成された正方形のPNG画像をダウンロードできます。フロントエンドはAstroで構築され、インタラクティブなUIはReactコンポーネント（Astroアイランド）によって実現されます。

## 2. 機能要件

### 2.1. フロントエンド (Astro + React)

- **UIコンポーネント群:**
  - **テキスト入力フィールド:** 絵文字にしたいテキストを入力する `<textarea>`。
  - **フォント選択:** APIから取得したフォントリストから選択するUI。
  - **カラーピッカー:** `react-color`などを利用した、視覚的な色選択UI。
  - **プレビューエリア:** バックエンドから取得した生成後の画像を表示する `<img>` タグ。
  - **ダウンロードボタン:** 生成された画像をダウンロードするボタン。
- **状態管理とロジック:**
  - `useEmojiGenerator.ts` というカスタムフックで、UIの状態とAPI通信に関するロジックを一元管理します。
  - React Context API (`EmojiGeneratorContext.ts`) を利用して、コンポーネント間のプロパティのバケツリレー（プロップドリル）を回避します。
- **インタラクション:**
  - ユーザーが設定を変更すると、一定時間後（デバウンス）にAPIへ画像生成リクエストが自動的に送信されます。
  - APIリクエスト中は、ローディング状態（スピナー表示など）になります。
  - APIから画像データを受け取り、プレビューエリアの `<img>` タグの `src` を更新します。

## 3. 使用技術

### 3.1. フロントエンド

- **フレームワーク:** **Astro (v4以降)**
- **UIフレームワーク (アイランド):** **React**
- **スタイリング:** **Tailwind CSS**
- **状態管理:** **React Hooks (useState, useContext) / カスタムフック**
- **アイコン:** `lucide-react`

### 3.2. バックエンド

- 既存のAPIサーバーを利用します。
- APIサーバーのベースURLは、プロジェクトルートの`.env`ファイル内の`PUBLIC_API_BASE_URL`で設定します。
  - デフォルトURL: `http://localhost:8000`
- OpenAPIドキュメントは、APIサーバーの`/docs`エンドポイント（例: `http://localhost:8000/docs`）で確認できます。

## 4. ディレクトリ構成 (Astro / React)

- **`/src`**
  - **`/components`**: UIを構成するReactコンポーネントを配置します。`EmojiGenerator.tsx`もここに含まれます。
  - **`/contexts`**: React Context APIの定義を配置します (`EmojiGeneratorContext.ts`)。
  - **`/hooks`**: 状態管理とビジネスロジックを担うカスタムフックを配置します (`useEmojiGenerator.ts`)。
  - **`/layouts`**: サイト全体の基本的なHTML構造を定義するレイアウトコンポーネントを配置します。
  - **`/lib`**: APIクライアント(`api.ts`)や定数(`constants.ts`)など、汎用的なロジックを配置します。
  - **`/pages`**: ユーザーがアクセスするWebページ (`index.astro`) を配置します。

## 5. コーディングルール

- **TypeScript:** `any` 型の使用は原則禁止します。
- **Astro/React:** UIのインタラクティブな部分はすべてReactコンポーネントに集約し、Astroページからは `<EmojiGenerator client:load />` のようにアイランドとして呼び出します。
- **Lint/Formatter:** ESLintとPrettierを導入し、コードスタイルを統一します。

## 6. 開発の進め方

1. **環境構築:**
   - `npm install`で依存関係をインストールします。
   - 外部APIサーバーを `http://localhost:8000` で起動します。
   - 必要に応じて、プロジェクトルートに`.env`ファイルを作成し、`PUBLIC_API_BASE_URL`を設定します。
2. **フロントエンド開発:**
   - `npm run dev`でAstroの開発サーバーを起動します。
   - 機能追加や修正は、主に`/src/components`, `/src/hooks`, `/src/contexts`内のファイルを対象に行います。
3. **テストとリファクタリング:**
   - コード全体の可読性やパフォーマンスをレビューし、改善します。
